name = "danmu-api"
main = "cf_worker.js"
compatibility_date = "2024-09-21"


# 基础环境变量（公开配置）
[vars]
ENABLE_ASYMMETRIC_AUTH_ENV = "false"
ENABLE_DETAILED_LOGGING = "true"
USER_AGENT_LIMITS_CONFIG = '''{{USER_AGENT_LIMITS_CONFIG}}'''
IP_BLACKLIST_CONFIG = '''{{IP_BLACKLIST_CONFIG}}'''


# wrangler.toml (wrangler v3.88.0^)
[observability.logs]
enabled = true

# Durable Object 绑定配置
[durable_objects]
bindings = [
  { name = "RATE_LIMITER", class_name = "RateLimiter" }
]

[[migrations]]
tag = "v3" # 保持原有的迁移标签
new_sqlite_classes = ["RateLimiter"]

[[migrations]]
tag = "v4" # 移除AppState，简化架构
deleted_classes = ["AppState"]
