name = "danmu-api"
main = "cf_worker.js"
compatibility_date = "2024-09-21"


# 基础环境变量（公开配置）
[vars]
ENABLE_ASYMMETRIC_AUTH_ENV = "false"
ENABLE_DETAILED_LOGGING = "true"
USER_AGENT_LIMITS_CONFIG = '''{{USER_AGENT_LIMITS_CONFIG}}'''
IP_BLACKLIST_CONFIG = '''{{IP_BLACKLIST_CONFIG}}'''


# wrangler.toml (wrangler v3.88.0^)
[observability.logs]
enabled = true

# Durable Object 绑定配置
[durable_objects]
bindings = [
  { name = "RATE_LIMITER", class_name = "RateLimiter" },
  { name = "APP_STATE", class_name = "AppState" }
]

[[migrations]]
tag = "v6" # 添加AppState，不触碰已存在的RateLimiter
new_sqlite_classes = ["AppState"]
